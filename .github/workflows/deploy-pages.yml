name: CI/CD 自动校验并部署到 GitHub Pages

# 触发条件：推送到 main 分支时执行
on:
  push:
    branches: [ main ]

# 定义任务
jobs:
  deploy-to-pages:
    # 运行环境：Ubuntu 最新版
    runs-on: ubuntu-latest

    # 任务步骤
    steps:
      # 步骤1：拉取仓库代码
      - name: 拉取仓库代码
        uses: actions/checkout@v4

      # 步骤2：校验 dist/index.html 是否存在（Linux 命令，Runner 是 Ubuntu）
      - name: 校验静态文件是否存在
        run: |
          if [ -f "dist/index.html" ]; then
            echo "✅ dist/index.html 文件存在，校验通过！"
          else
            echo "❌ dist/index.html 文件缺失，校验失败！"
            exit 1
          fi

      # 步骤3：部署到 GitHub Pages
      - name: 部署到 GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist          # 要部署的目录
          publish_branch: gh-pages     # 部署到 gh-pages 分支
          force_orphan: true           # 清空 gh-pages 分支历史，避免冲突